SHELL := /bin/bash
.SHELLFLAGS := -e -o pipefail -c

# --------------------------------------------------
# Docker lifecycle
# --------------------------------------------------

up:
	docker compose up -d --build

down:
	docker compose down

logs:
	docker compose logs -f

ps:
	docker compose ps

# --------------------------------------------------
# Soft reset: preserve DB
# --------------------------------------------------

soft-reset:
	@echo "ðŸ§¹ Stopping containers and cleaning images..."
	docker compose down --remove-orphans
	-docker image rm initialsdb-dev
	@echo "âœ… Soft reset done (DB preserved)."

# --------------------------------------------------
# Hard reset: wipe DB
# --------------------------------------------------

hard-reset:
	@echo "ðŸ§¹ Stopping containers and cleaning images..."
	docker compose down --remove-orphans
	-docker image rm initialsdb-dev
	@echo "ðŸ’£ Wiping dev database volume..."
	docker volume rm initialsdb_postgres_dev || true
	@echo "âœ… Hard reset done (DB fully wiped)."


# ==================================================
# Convenience aliases
# ==================================================

reset: soft-reset

nuke-db: hard-reset

# ==================================================
# Optional: full rebuild target
# ==================================================
# rebuild: hard-reset up
#	@echo "âœ… Production environment rebuilt from scratch."